<section>
  <div class="container rs-search">
    <div class="rs-search__item">
      <label for="search">Search</label>
      <input data-search-input id="search-by" type="text">
      <span class="fa fa-search"></span>
    </div>
    <div class="rs-search__item">
      <label for="filter">Filter</label>
      <select name="options" id="filter-by">
        <option selected>Select an option</option>
        <option value="article">Article</option>
        <option value="podcast">Podcast</option>
        <option value="presentation">Presentation</option>
        <option value="tool">Tool</option>
        <option value="tutorial">Tutorial</option>
        <option value="video">Video</option>
        <option value="website">Website</option>
        <option value="video">Video</option>
      </select>
      <span class="fa fa-caret-down"></span>
    </div>
    <div class="rs-search__item">
      <button id="button-search" class="btn-purple">search</button>
    </div>
  </div>
</section>

<script type="text/javascript">
  var baseurl = "{{.Site.BaseURL}}";
</script>
<script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.2/lunr.min.js"></script>

<script>
  var lunrIndex;
  var pagesIndex;
  function initLunr() {
    $.getJSON(baseurl + "resources/resources.json")
      .done(function (index) {
        pagesIndex = index;
        lunrIndex = lunr(function(){
          this.ref('uri');
          this.field('title', {
            boost: 15
          });
          this.field('tags', {
            boost: 10
          });
          this.field("content", {
            boost: 5
          });

          pagesIndex.forEach(function (page) {
            this.add(page);
          }, this);
        })
        lunrIndex.pipeline.remove(lunrIndex.stemmer)
        console.info(lunrIndex);
      })
      .fail(function (jqxhr, textStatus, error) {
        var err = textStatus + ", " + error;
        console.error("Error getting Hugo index flie:", err);
      });
  }

  function search(query) {
    return lunrIndex.search(query).map(function (result) {
      return pagesIndex.filter(function (page) {
        return page.uri === result.ref;
      })[0];
    });
  }

  initLunr();

  $(document).ready(function(){
    var result;
    $('#search-by').keypress(function(e){
      if (e.which === 13) {
        result = search($(this).val());
      }
    })

    $('#button-search').click(function(){
      result = search($('#search-by').val());
    })

    $('#filter-by').change(function(){
      var selected = $("select option:selected").text();
      result = search(selected);
    });
  });
  
</script>
