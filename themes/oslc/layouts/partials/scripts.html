<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.2.1/owl.carousel.min.js"></script>
<script src="https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Clamp.js/0.5.1/clamp.min.js"></script>
<script src="{{ .Site.BaseURL }}js/header.js"></script>


<script type="text/javascript">
  var baseurl = "{{.Site.BaseURL}}";
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.2/lunr.min.js"></script>

<script>
  var lunrIndex;
  var pagesIndex;

  function initLunr() {
    $.getJSON(baseurl + "site.json")
      .done(function (index) {
        pagesIndex = index;
        lunrIndex = lunr(function(){
          this.ref('uri');
          this.field('title', {
            boost: 15
          });
          this.field('tags', {
            boost: 10
          });
          this.field("content", {
            boost: 5
          });

          pagesIndex.forEach(function (page) {
            this.add(page);
          }, this);
        })
        lunrIndex.pipeline.remove(lunrIndex.stemmer)
        console.info(lunrIndex);
      })
      .fail(function (jqxhr, textStatus, error) {
        var err = textStatus + ", " + error;
        console.error("Error getting Hugo index flie:", err);
      });
  }

  function search(query) {
    return lunrIndex.search(query).map(function (result) {
      return pagesIndex.filter(function (page) {
        return page.uri === result.ref;
      })[0];
    });
  }

  function results(r) {
    console.info('results are', r);
    window.localStorage.setItem('results', JSON.stringify(r));

    window.location.href = baseurl + 'search';
  }

  initLunr();

  $(document).ready(function(){
    var result;
    var filterBy;
    
    $('#search-input-site').keypress(function(e){
      if (e.which === 13) {
        result = search($(this).val());
        results(result)
      }
    })

    $('#search-button-site').click(function(){
      var searchBy = $('#search-input-site').val();
      result = search(searchBy);
      results(result)
    })

  });
  
</script>
